---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const title = "Blog — Marketing Tactics for Vibe Coders | CodeToCash";
const description = "Actionable marketing articles for developers. Learn DRM, copywriting, email marketing, and growth strategies.";

const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const featuredPost = allPosts.find(p => p.data.featured) || allPosts[0];
const regularPosts = allPosts.filter(p => p.id !== featuredPost?.id);

const categories = [
  { id: 'all', label: 'All' },
  { id: 'fundamentals', label: 'Fundamentals' },
  { id: 'copywriting', label: 'Copywriting' },
  { id: 'email', label: 'Email' },
  { id: 'ads', label: 'Ads' },
  { id: 'analytics', label: 'Analytics' },
  { id: 'strategy', label: 'Strategy' },
];

const categoryColors: Record<string, { bg: string; text: string; border: string }> = {
  fundamentals: { bg: 'bg-blue-500/10', text: 'text-blue-400', border: 'border-blue-500/20' },
  copywriting:  { bg: 'bg-purple-500/10', text: 'text-purple-400', border: 'border-purple-500/20' },
  email:        { bg: 'bg-green-500/10', text: 'text-green-400', border: 'border-green-500/20' },
  ads:          { bg: 'bg-yellow-500/10', text: 'text-yellow-400', border: 'border-yellow-500/20' },
  analytics:    { bg: 'bg-cyan-500/10', text: 'text-cyan-400', border: 'border-cyan-500/20' },
  strategy:     { bg: 'bg-coral/10', text: 'text-coral', border: 'border-coral/20' },
};

const categoryLabels: Record<string, string> = {
  fundamentals: 'Fundamentals',
  copywriting: 'Copywriting',
  email: 'Email',
  ads: 'Ads',
  analytics: 'Analytics',
  strategy: 'Strategy',
};
---

<Layout title={title} description={description}>

  <!-- Hero -->
  <section class="relative overflow-hidden py-20 md:py-24">
    <div class="absolute inset-0 pointer-events-none">
      <div class="absolute top-1/3 right-1/4 w-80 h-80 bg-coral/5 rounded-full blur-3xl"></div>
    </div>
    <div class="relative max-w-3xl mx-auto px-6 text-center">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold leading-tight mb-6">
        Blog — Marketing Tactics for <span class="text-coral">Vibe Coders</span>
      </h1>
      <p class="text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed">
        Actionable articles on direct response marketing, copywriting, and growth strategies for developers who ship.
      </p>
    </div>
  </section>

  <!-- Category Filters -->
  <section class="max-w-5xl mx-auto px-6 mb-12">
    <nav class="flex flex-wrap gap-2 justify-center">
      {categories.map((cat) => (
        <button
          data-filter={cat.id}
          class={`filter-btn px-4 py-2 rounded-xl text-sm font-medium border transition-all cursor-pointer ${cat.id === 'all' ? 'bg-coral/10 text-coral border-coral/20' : 'bg-white/5 text-gray-400 border-white/10 hover:text-white hover:border-white/20'}`}
        >
          {cat.label}
        </button>
      ))}
    </nav>
  </section>

  <div class="max-w-5xl mx-auto px-6 pb-24">
    <!-- Featured Post -->
    {featuredPost && (
      <a
        href={`/blog/${featuredPost.id}`}
        data-category={featuredPost.data.category}
        class="blog-card group block mb-12 p-6 md:p-8 bg-navy-light border border-white/5 rounded-2xl hover:border-coral/20 hover:bg-white/[0.02] transition-all"
      >
        <div class="flex items-center gap-3 mb-4">
          <span class="px-2 py-0.5 rounded-md text-xs font-medium bg-coral/20 text-coral border border-coral/30">Featured</span>
          {(() => {
            const fc = categoryColors[featuredPost.data.category];
            return (
              <span class={`px-2 py-0.5 rounded-md text-xs font-medium ${fc.bg} ${fc.text} border ${fc.border}`}>
                {categoryLabels[featuredPost.data.category]}
              </span>
            );
          })()}
          <span class="text-xs text-gray-500">{featuredPost.data.readingTime}</span>
        </div>
        <h2 class="text-2xl md:text-3xl font-bold text-white group-hover:text-coral transition-colors mb-3 leading-tight">
          {featuredPost.data.title}
        </h2>
        <p class="text-gray-400 leading-relaxed mb-4 max-w-2xl">{featuredPost.data.description}</p>
        <div class="flex items-center text-sm text-coral/70 group-hover:text-coral transition-colors">
          Read article
          <svg class="w-4 h-4 ml-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </div>
      </a>
    )}

    <!-- Post Grid -->
    <div class="grid gap-6 md:grid-cols-2">
      {regularPosts.map((post) => {
        const pc = categoryColors[post.data.category] || categoryColors.fundamentals;
        const date = post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        return (
          <a
            href={`/blog/${post.id}`}
            data-category={post.data.category}
            class="blog-card group flex flex-col p-6 bg-navy-light border border-white/5 rounded-2xl hover:border-coral/20 hover:bg-white/[0.03] transition-all duration-200 hover:-translate-y-0.5"
          >
            <div class="flex items-center gap-2 mb-3">
              <span class={`inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium ${pc.bg} ${pc.text} border ${pc.border}`}>
                {categoryLabels[post.data.category]}
              </span>
              <span class="inline-flex items-center gap-1 text-xs text-gray-500">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                {post.data.readingTime}
              </span>
            </div>
            <h2 class="text-lg font-semibold text-white group-hover:text-coral transition-colors mb-2 leading-snug">
              {post.data.title}
            </h2>
            <p class="text-sm text-gray-400 leading-relaxed flex-1 mb-4">{post.data.description}</p>
            <div class="flex items-center justify-between pt-4 border-t border-white/5">
              <span class="text-xs text-gray-500">{date}</span>
              <span class="flex items-center text-sm text-coral/70 group-hover:text-coral transition-colors">
                Read
                <svg class="w-3.5 h-3.5 ml-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              </span>
            </div>
          </a>
        );
      })}
    </div>
  </div>

  <script>
    const filterBtns = document.querySelectorAll('.filter-btn');
    const blogCards = document.querySelectorAll('.blog-card');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const filter = btn.getAttribute('data-filter');

        filterBtns.forEach(b => {
          b.classList.remove('bg-coral/10', 'text-coral', 'border-coral/20');
          b.classList.add('bg-white/5', 'text-gray-400', 'border-white/10');
        });
        btn.classList.remove('bg-white/5', 'text-gray-400', 'border-white/10');
        btn.classList.add('bg-coral/10', 'text-coral', 'border-coral/20');

        blogCards.forEach(card => {
          const cat = card.getAttribute('data-category');
          if (filter === 'all' || cat === filter) {
            (card as HTMLElement).style.display = '';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      });
    });
  </script>

</Layout>
